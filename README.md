# nand2tetris
```text
《计算机系统要素——从零开始构建现代计算机》学习记录
部分答案参考自：https://github.com/woai3c/nand2tetris
```

### 概述杂记
```text
· 自己动手从与非门到俄罗斯方块，不考虑效率和异常处理。
· 注意多位二进制的表达顺序是[n]～[0]，不是[0]~[n]
· 在计算机内部，一切都使用二进制代码表示。例如，当我们按下标有1、9的键盘键并响应“给出素数示例”的Enter键时，最终存储在计算机内存中的二进制代码10011。当我们要求计算机在屏幕上显示此值时，随后会出现以下过程。首先，计算机的操作系统计算10011表示的小数值，恰好是19。将此整数值转换为两个字符1和9后，操作系统会查找当前字体，并获得用于在屏幕上渲染这些字符的两个位图图像。然后，操作系统导致屏幕驱动程序打开和关闭相关像素，并且，不要屏住呼吸——整个过程持续了一小部分秒——我们终于看到图像19出现在屏幕上。
· 本例的像素是由单比特控制，只能黑白，现在是8比特控制一个像素，显示更多的颜色。而且现代显卡不允许CPU直接驱动像素，它让CPU告诉它“绘制一行”、“绘制圆圈”等高级指令。
· 本例的CPU不参与“复杂指令集”和“精简指令集”的阵营之争。
```

### 缩写说明
```text
· ALU：算术逻辑单元
· LSB：最右边的二进制有效位（不超出寄存器为有效）
· MSB：最左边的二进制有效位（不超出寄存器为有效）
· Nand：与非门，Not(And(x))的简称
· DFF：数据触发器。data flip-flop
```

### 名词解释
```text
· 字长（Word Size）：寄存器位数，决定了能存储多大的数字。高级语言都可以表示超出寄存器大小的数字，使通过拼凑寄存器实现的。
· 基补码（two‘s complement）：一种存储有符号二进制数的编码方式。
```

#### 摘自豆瓣书评（陈硕）
```text
· 读这本书最大的收获，原来设计一个“从内存中读取指令并执行”的电路并不如想象中那么复杂，用几十个D触发器加一堆逻辑门就能搞出来。数字电路方面，模型比较理想化，要想真的用TTL或FPGA实现Hack还有一些现实的困难要克服。没有说明CPU如此设计的理由和权衡点。硬件设计，特别是CPU的设计，是为软件服务的，具体地说，就是成为C语言的编译目标，CPU提供的指令应该能充分支持C语言的高效实现，毕竟C语言是使用最广泛的系统语言。这一点Hack并没有完全做到，甚至没有提到，比如它没有逻辑移位指令（C语言有移位操作符），也不能实现函数调用（因为PC的值不能压栈）。Hack的A寄存器可以用来作基址寄存器，即内存访问时的地址，等于是个指针。如果书中能把C语言的常见指针操作用Hack汇编语言翻译阐述一遍，就能相互映照，加深理解，但可惜没有。这方面， Patterson & Hennessy 那本《Computer Organization and Design: The Hardware/Software Interface》要好得多。不过，cod讲的CPU可就没那么容易实现了，那是一块类MIPS的32-bit RISC CPU。
· CPU除了支持C语言，另外还得支持现代操作系统，具体说来，就是区分用户态和内核态，支持系统调用以便在两者之间转换，支持虚拟内存，让多个进程能有彼此独立的地址空间，等等。这方面我还没有找到一本特别好的书，很多操作系统教材以X86为例，但x86的内存管理机制复杂得一塌糊涂，补丁累补丁（8086->80286->80386->x64，一路补丁打下来，还得向下兼容），花精力在这上面实在不值。我希望能看到以MIPS或者ARM为平台的操作系统教材。
性能方面，书中也着墨不多。Hack造出来了，那么它的性能如何，够不够快，能不能更快，瓶颈在哪里？Hack CPU是一个同步时序逻辑电路，它的时钟频率能上到多少MHz，制约因素是啥，它能容忍的clock skew是多少ps，它在执行指令时各个信号的时序图如何，这些书里都没有提到。Hack是个单周期CPU，如果要提速，一般是流水化+cache，这又会引入一大堆的头疼问题。这方面，《Computer Systems: A Programmer's Perspective》讲得很好。
Hack的另外一个弱点是输入输出，它用内存映射方式的IO，这本身没问题，但是它不支持中断，也就是说只能用轮询的方式输入输出数据，这可不妙。中断是一个关键概念，不仅是输入输出，单CPU上能实现多任务，全靠操作系统在处理时钟中断时顺便切换当前任务（当然，也有其他切换任务的机会，比如从系统调用返回时）。要学这一块看似神奇的任务切换，不用劳烦复杂的操作系统教材，一本uC/OS-II的书就搞定了。
· 学Hack，好处是它简单，几天就能上手弄懂；坏处是它太简单，可以作为学习的起点，但不宜作为学习的全部。

· 这本书如何和《编码》相比，可以算做《编码》内容的继续深入。《计算机系统要素》之后可以看清华大学 网格与集群计算研究组 的《CPU芯片逻辑设计》。或者从日本引进的三件套《30天自制操作系统》《CPU自制入门》《自制编程语言》。

· 《操作系统设计 xinu方法》就是讲基于mips的嵌入式系统。
```