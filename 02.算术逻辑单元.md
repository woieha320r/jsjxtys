# 02.算术逻辑单元

### 功用
```text
· 负责提供基本数字运算函数的芯片，计算机的所有操作都可简化为有符号二进制整数相加，在本例中其他复杂运算在系统层通过软件实现。
```

### 有符号的二进制整数
```text
· 二进制加法：从两个数最右边的位开始，按位相加（两个位相加再加其右边相加的进位），达2时进位1，不关心最左边的溢出。
· 现主流采用基补码方式来存储有符号的二进制数：在一个n位的二进制系统中，-x定义为：|-x| == 0 ? 0 : 2^n - |-x|。比如-2的二进制表示是2^5 - 2 = 30 = 0b11110。
· 基补码有如下特点：数据范围是[-2(n-1), 2^(n-1)-1]；正负整数的首位分别是0和1。
· 还有些便于硬件实现的特点：负整数加法和正整数加法完全相同；减法直接采用加负数表示；将x按位取反加1就可得到-x。
```

### 习题
```text
本例的ALU是独有的设计，只实现18个函数，且只进行整数运算。
```
![半加器](img/E30E03F3-BEAB-4CB5-91D5-A91A4BBAFC25.png)
```text
sum = Xor(a, b)
carry = And(a, b)
```
![全加器](img/E2FB58C7-3945-4480-9A37-AACDB1D8623D.png)
```text
使用HDL描述
HalfAdder(a = a, b = b, sum = sumAb, carry = carryAb);
HalfAdder(a = sumAb, b = c, sum = sum, carry = carryAbc);
Or(a = carryAb, b = carryAbc, out = carry);
```
![16位全加器](img/90BC73A3-1AF4-413C-A66D-0B47CB6913B0.png)
```text
使用HDL描述
FullAdder(a = a[0], b = b[0], c = false, sum = out[0], carry = carry0);
FullAdder(a = a[1], b = b[1], c = carry0, sum = out[1], carry = carry1);
...
FullAdder(a = a[14], b = b[14], c = carry13, sum = out[14], carry = carry14);
FullAdder(a = a[15], b = b[15], c = carry14, sum = out[15]);
```
![16位自增](img/6DD8E235-F2C2-4ECB-9D55-5313D153BA55.png)
```text
使用HDL描述
// 将true或false扩展为16位
CHIP ExpandBool16 {
    IN in;
    OUT out[16];
    PARTS:
    Or(a = in, b = false, out = out[0]);
    Not(in = true, out = out[1]);
    Not(in = true, out = out[2]);
    Not(in = true, out = out[3]);
    Not(in = true, out = out[4]);
    Not(in = true, out = out[5]);
    Not(in = true, out = out[6]);
    Not(in = true, out = out[7]);
    Not(in = true, out = out[8]);
    Not(in = true, out = out[9]);
    Not(in = true, out = out[10]);
    Not(in = true, out = out[11]);
    Not(in = true, out = out[12]);
    Not(in = true, out = out[13]);
    Not(in = true, out = out[14]);
    Not(in = true, out = out[15]);
}

ExpandBool16(in = true, out = true16);
Add16(a = in[0..15], b = true16, out = out[0..15]);
```
![算术逻辑单元概图](img/C1D16189-1FBA-4361-8BA2-3603E971B31F.png)
![算术逻辑单元函数图](img/18148012-D1DA-4757-A677-C2B1C1D45C03.png)
```text
使用HDL描述
CHIP IfZero16 {
    IN isZero, in[16];
    OUT out[16];
    PARTS:
        ExpandBool16(in = false, out = false16);
        Mux16(a = in[0..15], b = false16, sel = isZero, out = out);
}
CHIP IfNot16 {
    IN isNot, in[16];
    OUT out[16];
    PARTS:
        Not16(in = in[0..15], out = notIn);
        Mux16(a = in[0..15], b = notIn, sel = isNot, out = out);
}
CHIP AddOrAnd16 {
    IN isAdd, a[16], b[16];
    OUT out[16];
    PARTS:
        Add16(a = a[0..15], b = b[0..15], out = add16);
        And16(a = a[0..15], b = b[0..15], out = and16);
        Mux16(a = and16, b = add16, sel = isAdd, out = out);
}
CHIP IsZero16 {
    IN in[16];
    OUT out;
    PARTS:
        Or8Way(in = in[0..7], out = exists1In07);
        Or8Way(in = in[8..15], out = exists1In815);
        Or(a = exists1In07, b = exists1In815, out = exists1);
        Not(in = exists1, out = out);
}
CHIP LessThanZero16 {
    IN in[16];
    OUT out;
    PARTS:
        Mux(a = false, b = true, sel = in[15], out = out);
}

IfZero16(in = x[0..15], isZero = zx, out = judgeZeroX);
IfNot16(in = judgeZeroX, isNot = nx, out = judgeNotX);
IfZero16(in = y[0..15], isZero = zy, out = judgeZeroY);
IfNot16(in = judgeZeroY, isNot = ny, out = judgeNotY);
AddOrAnd16(a = judgeNotX, b = judgeNotY, isAdd = f, out = waitJudgeOut);
IfNot16(in = waitJudgeOut, isNot = no, out = hasOut);
Or16(a = hasOut, b = false, out = out);
IsZero16(in = hasOut, out = zr);
LessThanZero16(in = hasOut, out = ng);

```